
<%--
(ref: jsp/jsp.jsp.et.jsp)
-------------------------------------
$Revision:   $
$Date:  $
$Author:  $Generated by Engineer, Enhanced by Sandeep
$Modtime: $

Version History:
-------------------------------------
$Log:$
--%>
<%@ page language="java"%>
<%@ page import="com.cdoe.ui.*"%>
<%@ page import="com.cdoe.biz.*"%>
<%@ page import="com.cdoe.util.*"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="tiles" uri="http://tiles.apache.org/tags-tiles"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>

<%-- Wrap the entire JSP in a try/catch block so that runtime exceptions
    in the JSP can be caught and reported. --%>
<%@include file="/WEB-INF/jsp/JspTry.inc"%>

<%
	String prevFiscalYear = DateUtil.getPrevFiscalYear();
		String formattedFiscalYear = DateUtil
				.getFiscalYearFormattedLong(prevFiscalYear);
		UserInfo userInfo = (UserInfo) session
				.getAttribute("USER_INFO");
				
%>
<script type='text/javascript'>
	 $(document)
    .ready(
    function() {
        
        
        
        
        
        
        
        
        
        
        
        
                           
         if ('None' == document.getElementById('validationErrors').value) {
                        $('#MessageFont').html(transportationForm.message);
                        //disable input
                        $('input').attr('disabled', true);
                        $('#saveButton').attr('disabled','disabled');
                      
         } else {
                    	$('input').attr('disabled', false);
         }
                                            
        /*
         *  Attached function to dropdown's onchange event.
         *
         */
        $('select#districtNumber')
        .change(
        function() {
            var varDistrictNumber = "";
            $(
            "select#districtNumber option:selected")
            .each(
            function() {
                varDistrictNumber += $(
                this)
                .text();
            });

            $
            .getJSON(
            '${pageContext.request.contextPath}/secure/Cde40TransReimbForm/json',
            {
                districtNumber : varDistrictNumber
            },
            function(json) {
                if (json.transportationForm.valid) {
                    clearAll();
                    $('.validationError').hide();
					$('#recordId').val(json.transportationForm.id);
                    $('input#DistrictName').val(json.transportationForm.districtName);
                    $('input#isCapitalOutLay').val(json.transportationForm.isCapitalOutLay);
                    $('input#namePreparerCde40').val(json.transportationForm.namePreparerCde40);
                    $('input#emailPreparerCde40').val(json.transportationForm.emailPreparerCde40);
                    $('input#phonePreparerCde40').val( json.transportationForm.phonePreparerCde40);
                    $('input#TotalCurrentOperatingExp').val(json.transportationForm.operTran);
                   
                    $(
                    'input#regDMiles')
                    .val(
                    json.transportationForm.regDMiles)
                    $(
                    'input#DaysSchoolWasInSession')
                    .val(
                    json.transportationForm.schoolDays);
                    $(
                    'input#boardTran')
                    .val(
                    json.transportationForm.boardTran);
                    $(
                    'input#mileageEntitlement')
                    .val(
                    json.transportationForm.mileageEntitlement);
                    $(
                    'input#excessCosts')
                    .val(
                    json.transportationForm.exCosts);
                    $(
                    'input#expenseReimbursement')
                    .val(
                    json.transportationForm.exReim);
                    $(
                    'input#mileageEntitlement')
                    .val(
                    json.transportationForm.mileageEntitlement);
                    $(
                    'input#maxReimEntitlement')
                    .val(
                    json.transportationForm.maxReimEntitlement);
                    $(
                    'input#reimbursementTranportation')
                    .val(
                    json.transportationForm.reimTran);
                    $(
                    'input#reimbursementTranportationLastYear')
                    .val(
                    json.transportationForm.reimTranLy);
                    $(
                    'input#reimEntitlement')
                    .val(
                    json.transportationForm.reimEntitlement);
                    $(
                    'input#boardTran')
                    .val(
                    json.transportationForm.boardTran);
                    $(
                    'input#NosOfPupilSchedules')
                    .val(
                    json.transportationForm.pupilTran);
                    $('input#TotalActualMilesTravelled')
                    .val(
                    json.transportationForm.actMiles);
                    $(
                    'input#TotalActualMilesTraveledForAnyPurpose')
                    .val(
                    json.transportationForm.totalMiles);
                                                                                                                                                                                                                                                                                       
                    if ('None' == json.transportationForm.errors) {
                        $('#MessageFont').html(json.transportationForm.message);
                        //disable input
                        $('input').attr('disabled', true);
                        $('#saveButton').attr('disabled','disabled');
                      
                    } else {
                    	$('input').attr('disabled', false);
                    }
					formatFields();												
                                                                                                                                        

                } else {
                    clearAll();
                    $('input').attr('disabled', false);
                    
                    $('#recordId').val(json.transportationForm.id);
                    $('#MessageFont').html("");
                    $('input#recordId').val(json.transportationForm.id);
                    $('input.disabled').attr('disabled', false);  
                    $('#saveButton').removeAttr('disabled');
                    $('input#isCapitalOutLay').val(json.transportationForm.isCapitalOutLay);
                    $('input#validationErrors').val(json.transportationForm.errors);
				
																	
                    $(
                    'input#DistrictName')
                    .val(json.transportationForm.districtName);
                    if (json.transportationForm.message) {
                        $('#MessageFont').html(json.transportationForm.message);
                        //disable input
                        //$('input.disabled').attr('disabled', true);
                        //$('#saveButton').attr('disabled','disabled');
                      
                    }
																	
                  /*  $(
                    'input#namePreparerCde40')
                    .val("");
                    $(
                    'input#emailPreparerCde40')
                    .val("");
                    $(
                    'input#phonePreparerCde40')
                    .val("");
                    $(
                    'input#TotalCurrentOperatingExp')
                    .val(0.00);
                   
                    $(
                    'input#regDMiles')
                    .val(0.0)
                    $(
                    'input#DaysSchoolWasInSession')
                    .val(0);
                    $(
                    'input#boardTran')
                    .val(0);
                    $(
                    'input#boardTran')
                    .val(0);
                    $(
                    'input#NosOfPupilSchedules')
                    .val(0);
                    $(
                    'input#TotalActualMilesTravelled')
                    .val(0.0);
                    $(
                    'input#TotalActualMilesTraveledForAnyPurpose')
                    .val(0.0);	*/
          															
                }
                     
               
            })
        })
  })
</script>


<script language="javascript" type="text/javascript">
	function saveData() {
		if (document.getElementById("isCapitalOutLay") == null || document.getElementById("isCapitalOutLay").value == "false")
			alert("Your CDE-40 Form will be validated and submitted. If the form is valid it will be saved and considered as completed. A pdf copy of the CDE-40 will be emailed to the email address provided on this form. If any changes need to be made to this CDE-40 Form, please contact the Colorado Department of Education: 303-866-6843");
	    else
	        alert("You will need to complete the Capital Outlay Form also. Saving CDE-40 Form data and transferring to Capital Outlay Screen");
	
	}
	
	 function clearAll() {
	     clearField('namePreparerCde40');
	     clearField('emailPreparerCde40');
	     clearField('phonePreparerCde40');
	     clearField('TotalCurrentOperatingExp');
	     clearField('regDMiles');
	     clearField('DaysSchoolWasInSession');
	     clearField('boardTran');
	     clearField('NosOfPupilSchedules');
	     clearField('TotalActualMilesTravelled');
	     clearField('TotalActualMilesTraveledForAnyPurpose');   
	     checkAndFormatAmount('TotalCurrentOperatingExp');
	     clearField('namePreparerError');
		formatMileageField('regDMiles');
		formatMileageField('TotalActualMilesTravelled');
		formatMileageField('TotalActualMilesTraveledForAnyPurpose');
		formatIntegerField('DaysSchoolWasInSession');
		formatIntegerField('BoardTran');
		formatIntegerField('NosOfPupilSchedules');  
    }
    
     
    
    function formatFields() {
    	checkAndFormatAmount('TotalCurrentOperatingExp');
		formatMileageField('regDMiles');
		formatMileageField('TotalActualMilesTravelled');
		formatMileageField('TotalActualMilesTraveledForAnyPurpose');
		formatIntegerField('DaysSchoolWasInSession');
		formatIntegerField('BoardTran');
		formatIntegerField('NosOfPupilSchedules');
	}
    
</script>


<div>
	<form:form commandName="transportationForm"
		action="${pageContext.request.contextPath}/secure/Cde40TransReimbForm/save"
		method="post">

		<!-- Main outer table -->
		</br>
		<h2>
			<spring:message
				code="Cde40TransReimbForm.StaticText.reimbursementClaimsForEntitlementPeriodStaticText" />
			&nbsp;<%=formattedFiscalYear%>
		</h2>
		<font id="MessageFont" color="red"><c:out id="Message"
				value="${transportationForm.message}" /></font>
		<TABLE>
			<TR>
				<TD>
					<div class="formBlock boxShadow3 radius10">
						<h3>
							<spring:message
								code="Cde40TransReimbForm.StaticText.nameOfPersonPreparingTheReportStaticText" />
						</h3>
						<div style='float: left;'>
							<span class="field" style='width: 100px;'><label
								for="namePreparerCde40">Name</label></span> <span class="bodyText"
								style='width: 350px;'> <form:input id="namePreparerCde40"
									path="namePreparerCde40" size="25" maxlength="100" /><font	color="red">
									<form:errors path="namePreparerCde40" id="namePreparerError" cssClass="validationError" /><b>*</b></font>
							</span> <br /> 
								<span class="field" style='width: 100px;'> <LABEL	FOR="">Email Address</LABEL>
							</span> <span class="bodyText" style='width: 350px;'> <form:input
									id="emailPreparerCde40" path="emailPreparerCde40" size="40" maxlength="100"
									onBlur="validateEmail('emailPreparerCde40')" /><font color="red"> 
									<form:errors path="emailPreparerCde40" id="emailPreparerError" cssClass="validationError" /><b>*</b></font>
							</span> <br /> 
							<span class="field" style='width: 100px;'> <label
								for="phonePreparerCde40">Phone</label></span> <span class="bodyText"
								style='width: 350px;'> <form:input id="phonePreparerCde40"
									path="phonePreparerCde40" size="16" maxlength="16"
									onBlur="validatePhoneNos('phonePreparerCde40')" /> <font color="red">
									<form:errors path="phonePreparerCde40" id="phoneValidError" cssClass="validationError" /><b>*</b></font>
							</span>
						</div>
						<div
							style='float: left; background-color: #fafafa; border: 1px solid #ddd; padding: 0.5em 1em;'
							class='radius5'>
							<span class="field" style='width: 120px;'> <label
								for="districtNumber">District Number</label>
							</span>
							<c:choose>
								<c:when test="${districtNumbers != null}">

									<span><form:select id="districtNumber"
											path="districtNumber">
											<form:option value="${transportationForm.districtNumber}"
												label="-- Select --" />
											<form:options items="${districtNumbers}"></form:options>
										</form:select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
									<br />

								</c:when>
								<c:otherwise>
									<span class="bodyText"> <form:input id="DistrictNumber"
											path="districtNumber" size="12" maxlength="12"
											cssClass="disabled" readonly="true" />
									</span>
									<br />
								</c:otherwise>
							</c:choose>

							<span class="field" style='width: 120px;'> <label
								for="districtName">District Name</label>
							</span> <span class="bodyText"> <form:input id="DistrictName"
									path="districtName" size="26" maxlength="41"
									cssClass="disabled" readonly="true" />
							</span>
						</div>
						<div style='clear: both;'></div>
					</div>

					<TABLE>
						<!-- div id='hintRI' class="hint boxShadow3 radius5 right" -->
						<TR>

							<TD COLSPAN="6"><h3>
									<b><spring:message
											code="Cde40TransReimbForm.StaticText.reimbursementInformationStaticText" />
								</h3>
						   </TD>
							<TD><form:hidden id="recordId" path="id" />
								<form:hidden id="isCapitalOutLay" path="isCapitalOutLay" />
								<form:hidden id="validationErrors" path="errors" />
							</TD>
						</TR>

						<TR>

							<TD width="76%">&nbsp;&nbsp;<spring:message
									code="Cde40TransReimbForm.StaticText.$1aTotalCurrentOperatingExpendituresForPupilTransportationStaticText" />
							</TD>

							<TD width="24%">$<form:input id="TotalCurrentOperatingExp"
									path="operTran"
									onBlur="checkAndFormatAmount('TotalCurrentOperatingExp')" /><font
								color="red"><b>*</b> <form:errors path="operTran"
										cssClass="validationError" /></font>
								</div>
							</TD>
						</TR>
						<% if ("20112012".equals(prevFiscalYear) ||
						       "20102011".equals(prevFiscalYear) ||
						       "20092010".equals(prevFiscalYear)) { %>
						<TR>
								<TD width="78%">&nbsp;&nbsp;2a. Mileage traveled for transporting migrant education pupils
								</TD>
								<TD><form:input id="MigMilesOfTransportation"
										path="migMiles"
										onBlur="formatMileageField('MigMilesOfTransportation')" /><font color="red"><b>*</b> <form:errors
										path="migMiles" cssClass="validationError" /></font></td>
						</TR>
						<% } %>
						<TR>
							<TD width="78%">&nbsp;&nbsp;<LABEL FOR=""><spring:message
										code="Cde40TransReimbForm.StaticText.$3MileageScheduledForRegularPupilTransportationOnTheMileageCountDateStaticText" /></LABEL>
							</TD>
							<TD><form:input id="regDMiles" path="regDMiles"
									onBlur="formatMileageField('regDMiles')" /><font color="red"><b>*</b>
									<form:errors path="regDMiles" cssClass="validationError" /></font></TD>
						</TR>
						<TR>
							<TD width="78%">&nbsp;&nbsp;<spring:message
									code="Cde40TransReimbForm.StaticText.$4DaysSchoolWasInSessionAndPupilsWereTransportedInTheSchoolTermStaticText" />
							</TD>
							<TD width="24%"><form:input id="DaysSchoolWasInSession"
									path="schoolDays" /><font color="red"><b>*</b> <form:errors
										path="schoolDays" cssClass="validationError" /></font>
						    </td>
						</TR>

						<TR>
							<TD width="78%">&nbsp;&nbsp;<LABEL FOR=""><spring:message
										code="Cde40TransReimbForm.StaticText.$5NumberOfDaysForWhichRoomAndBoardWasPaidForPupilsInLieuOfTransportationStaticText" /></LABEL>
							</TD>
							<TD><form:input id="BoardTran" path="boardTran" />
								<form:errors path="boardTran" cssClass="validationError" /></td>
						</TR>


						<TR>
							<TD width="78%">&nbsp;&nbsp;<spring:message
									code="Cde40TransReimbForm.StaticText.$6NumberOfPupilsScheduledToBeTransportedToAndFromPublicSchoolAtPublicStaticText" />
									
							</TD>
						</TR>
						<TR>
							<TD>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expense on the mileage count date
							</TD>
						
							<TD><form:input id="NosOfPupilSchedules" path="pupilTran" /><font
								color="red"><b>*</b> <form:errors path="pupilTran"
										cssClass="validationError" /></font></TD>
						</TR>

						<TR>
							<TD width="78%">&nbsp;&nbsp;<spring:message
									code="Cde40TransReimbForm.StaticText.$7TotalActualMilesTraveledForActivityTripsFieldTripsAthleticTripsEtcDuringEntitlementPeriodStaticText" />
							</TD>
							<TD><form:input id="TotalActualMilesTravelled"
									path="actMiles"
									onBlur="formatMileageField('TotalActualMilesTravelled')" /><font
								color="red"><b>*</b> <form:errors path="actMiles"
										cssClass="validationError" /></font></TD>
						</TR>

						<TR>
							<TD width="78%">&nbsp;&nbsp;<spring:message
									code="Cde40TransReimbForm.StaticText.$8TotalActualMilesTraveledForAnyPurposeByPupilTransportationVehiclesDuringEntitlementPeriodStaticText" />
							</TD>
							<TD><form:input id="TotalActualMilesTraveledForAnyPurpose"
									path="totalMiles"
									onBlur="formatMileageField('TotalActualMilesTraveledForAnyPurpose')" /><font
								color="red"><b>*</b> <form:errors path="totalMiles"
										cssClass="validationError" /></font></TD>
						</TR>
						<!-- /div> -->
					</TABLE> </br>
					<TABLE>
						<TR>
							<TD width="48%"></TD>
							<TD align="center" colspan="4"><input type="Submit"
								id="saveButton" value="Save/Electronics Signature"
								onclick="saveData()" /></TD>
						</TR>
					</TABLE>
					</div>
				</TD>
			</TR>
		</TABLE>
	</form:form>
</div>
<script type="text/javascript"
	src="${pageContext.request.contextPath}/static/scripts/screen/Cde40TransReimbForm.js"></script>
<%-- End of try/catch around complete JSP in order to log and display
     runtime exceptions that occur in the JSP. --%>
<%@include file="/WEB-INF/jsp/JspCatch.inc"%>